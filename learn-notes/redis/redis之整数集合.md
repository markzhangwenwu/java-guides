

### 整数集合

整数集合是集合建的底层实现之一,当一个集合只包含整数值元素,并且这个集合元素数量不多时,redis就会使用整数集合作为集合建的底层实现.

它可以保持类型为int16_t,int32_t或者int64_t的整数,并且保证集合中不会出现重复元素.

```
typedef struct intset{
	//编码方式
	uint32_t encoding;
	//集合包含的元素数量
	uint32_t length;
	//保存元素的数组
	int8_t contents[];
}intset;


```

contents数组是整个集合的底层实现:整个集合的每一个元素都是contents数组的一个数组项(item),各个项在数组中按值得大小有序地排列,并且数组中不包含任何重复项.


- length属性记录了整数集合包含的元素数量,也就是contents数组的长度

- contents数组的真正类型取决于encoding属性的值


### 升级

每当我们将一个新元素添加到整数集合里面,并且新元素的类型必整数集合现有的元素的类型都长时,整数集合需要先进行升级,然后才能将新元素添加到整数集合里面.

- 根据新元素的类型,拓展整数集合底层数组的空间大小,并为新元素分配空间

- 将底层数组现有的所有元素转换成新元素相同的类型,并将类型转换后的元素放置到正确的位上,而且在放置元素的过程中,需要继续维持底层数组的有序性质不变.

-将新元素添加到底层数组里面.

